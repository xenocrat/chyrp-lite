{% extends "layout.twig" %}

{% block title %}${ "Manage Tags" | translate("tags") }{% endblock %}

{% block content %}
        <h2>${ "Manage Tags" | translate("tags") }</h2>
        <table>
            <thead> 
                <tr class="head">
                    <th class="tag_name">${ "Name" | translate("tags") }</th>
                    <th class="tag_count">${ "Posts Tagged" | translate("tags") }</th>
                    <th class="controls" colspan="2">${ "Controls" | translate }</th>
                </tr>   
            </thead>
            <tbody> 
                {% for tag in tag_cloud %}
                <tr>
                    <td class="tag_name main">
                        <a class="tag" href="index.php?action=$route.action&amp;query=${ tag.clean | escape }">$tag.name</a>
                    </td>
                    <td class="tag_count">
                        $tag.popularity
                    </td>
                    <td class="controls">
                        <a class="edit_tag" href="{% admin "rename_tag&clean="~ tag.clean %}"><img src="$theme_url/images/icons/edit.svg" alt="${ "edit" | translate }"></a>
                    </td>
                    <td class="controls">
                        <a class="delete_tag" href="{% admin "delete_tag&clean="~ tag.clean %}"><img src="$theme_url/images/icons/delete.svg" alt="${ "delete" | translate }"></a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td class="placeholder"><span class="sub">${ "(none)" | translate }</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <h2>{% if GET.query %}${ "Search Results" | translate }{% else %}${ "Posts" | translate }{% endif %}</h2>
            <form action="{% admin "bulk_tag" %}" method="post">
                <table class="interactive">
                    <thead>
                        <tr class="head">
                            <th class="toggler"></th>
                            <th class="post_title">${ "Post" | translate }</th>
                            <th class="post_tags">${ "Tags" | translate("tags") }</th>
                            <th class="controls">${ "Controls" | translate }</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for post in posts.paginated %}
                        <tr class="post">
                            <td class="checkbox">
                                <input type="checkbox" name="post[$loop.index0]" value="$post.id" id="post_checkbox_$post.id">
                            </td>
                            <td class="post_title">
                                <a class="edit_tag" href="$post.url">{% if post.title %}${ post.title | truncate(30, "â€¦", true) }{% else %}${ "(Untitled)" | translate }{% endif %}</a>
                            </td>
                            <td class="post_tags main">
                            {% for name, clean in post.tags | items %}
                                <a class="tag" href="index.php?action=$route.action&amp;query=${ clean | escape }">$name</a>
                            {% endfor %}
                            </td>
                            <td class="controls">
                                <a class="edit_tag edit_link" href="{% admin "edit_tags&id="~ post.id %}">${ '<img src="'~ theme_url ~'/images/icons/edit.svg" alt="'~ ("edit" | translate) ~'">' }</a>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td class="placeholder"><span class="sub">${ "(none)" | translate }</span></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div class="controls">
                    <h4>${ "Tag Selected Post(s) with:" | translate("tags") }</h4>
                    <input type="text" name="name" value="" id="name">
                    <button type="submit">${ "Tag" | translate("tags") }</button>
                    <input type="hidden" name="hash" value="${ ip | token }" id="hash">
                </div>
            </form>
            {% if posts.paginated and posts.pages > 1 %}
            <div class="pagination">
                <span class="pages">${ "Page %d of %s" | translate | format(posts.page, posts.final_link(posts.pages)) }</span>
                $posts.prev_link
                $posts.next_link
            </div>
            {% endif %}
{% endblock %}
